# ClusTime

ClusTimeは、共通の趣味や興味を持つ人々が「クラスタ」と呼ばれるコミュニティを形成し、活発に交流できるSNSアプリケーションです。FlutterとFirebaseを駆使して開発されており、リアルタイムなコミュニケーションを実現します。<br>
ここではソースコード本体は公開せず、設計のみ公開します。

## ✨ 主な機能

* **ユーザー認証**: メールアドレス、Google、Appleアカウントによる安全なサインアップとログイン機能を提供します。
* **クラスタ（コミュニティ）**:
    * ユーザーは自由にクラスタを作成し、参加できます。
    * 公開/非公開（承認制）の設定が可能です。
    * クラスタごとにプロフィール（バナー、アイコン、説明、ルール）をカスタマイズできます。
* **投稿**:
    * テキスト、複数画像の投稿が可能です。
    * いいね、返信、リポスト、引用リポストといった基本的なSNS機能を網羅しています。
    * 投稿のエンゲージメント（いいね、リポストしたユーザー）を確認できます。
* **ニュース**:
    * クラスタ内でURLを共有し、OGP情報をリッチに表示するニュース機能があります。
* **検索**:
    * クラスタ名での検索機能を提供します。
    * ジャンル別のクラスタ発見や、トレンド/アクティブなクラスタのランキングも表示します。
* **通知**:
    * いいね、リプライ、リポストなどのアクションをリアルタイムで通知します。
    * Firebase Cloud Messaging (FCM) を活用し、アプリがバックグラウンドや終了状態でも通知を受け取れます。
* **プロフィール**:
    * プロフィールの編集（表示名、ユーザーID、自己紹介、プロフィール画像）が可能です。
    * ユーザーごとの投稿、いいね、ブックマークした投稿を一覧で確認できます。
    * ユーザーのブロック機能も搭載しています。
* **管理機能**:
    * 不適切な投稿やユーザーを通報する機能があります。
    * 管理者向けのレビューパネルで、通報内容の確認と対応（承認、削除など）が可能です。

---


## 🏛️ アーキテクチャ


* **UIフレームワーク**: Flutter (Cupertinoデザイン)
* **バックエンド**: Firebase (Authentication, Firestore, Cloud Functions, Storage, App Check, Crashlytics)
* **状態管理**: [Riverpod](https://riverpod.dev/)
* **主要なパッケージ**:
    * `firebase_core`, `firebase_auth`, `cloud_firestore`, `cloud_functions`, `firebase_storage`
    * `flutter_riverpod`
    * `table_calendar` (カレンダー表示)
    * `cached_network_image` (画像キャッシュ)
    * `image_picker`, `image_cropper` (画像選択・編集)
    * `google_mobile_ads` (広告)
    * `timeago` (相対時間表示)

---

## 🛠️ 設計思想と技術的ハイライト

本プロジェクトは、単に機能を実現するだけでなく、**保守性・拡張性・堅牢性**を重視した設計思想に基づいています。

### 1. アーキテクチャ：Feature-Driven Design × レイヤードアーキテクチャ

* **機能単位での関心事の分離**: `lib/features` ディレクトリ以下に機能ごとのモジュールを配置する **Feature-Driven Design** を採用しています。これにより、機能追加や修正が他の機能へ与える影響を最小限に抑え、コードベースの見通しを良くしています。
* **依存関係の明確化**: 各機能モジュールは `application` (ビジネスロジック), `data` (データ層), `presentation` (UI層) に分割されています。このレイヤードアーキテクチャにより、UI、ロジック、データソース間の依存関係が一方向に保たれ、各層の独立したテストや変更が容易になります。

### 2. 状態管理：Riverpodによる宣言的なUI構築

* **依存性注入 (DI)**: `Riverpod` を全面的に採用し、`Provider` を介してRepositoryやServiceといった依存性を注入しています。これにより、ウィジェットツリーのどこからでも安全に依存関係にアクセスでき、コンポーネントの再利用性とテスト容易性を高めています。
* **宣言的なデータフェッチ**: `StreamProvider` や `FutureProvider` を活用し、Firebaseとの非同期通信やリアルタイムなデータ更新を宣言的に記述。ローディング、エラー、データ表示といったUIの状態分岐をシンプルかつ堅牢に実装しています。
* **イミュータブルな状態**: `freezed` を用いて状態クラスを不変（イミュータブル）に保っています。これにより、予期せぬ状態の変更を防ぎ、アプリケーションの動作を予測可能にしています。

### 3. バックエンド連携：Cloud Functions for Firebaseの活用

* **サーバーサイド・ロジック**: 投稿の作成・削除、ユーザー参加、権限譲渡といった複雑なデータベース操作やセキュリティが重要な処理は、**Cloud Functions** に集約しています。
* **クライアントの責務軽減**: クライアントアプリはUIの描画とユーザーインタラクションに集中。サーバーサイドにロジックをオフロードすることで、クライアント側のコードをシンプルに保ち、アプリのパフォーマンスとセキュリティを向上させています。

### 4. 高い再利用性と一貫性を持つUIコンポーネント

* **共通コンポーネント**: `lib/shared/widgets` に、認証ボタン、ポップアップ、インジケーターなど、アプリ全体で再利用可能なUIコンポーネントを多数配置。コードの重複を避け、一貫したユーザー体験を提供します。
* **テーマ管理**: `lib/app/theme` にて、ダークモード対応を含むアプリ全体の配色やスタイルを一元管理。UIの変更や新たなテーマの追加が容易な設計となっています。

### 5. 開発と運用の効率化

* **Flavorによる環境分離**: `main_prod.dart` と `main_beta.dart` を用意し、**Flavor** を用いて本番環境とベータ環境を完全に分離。FirebaseプロジェクトやAPIキーを環境ごとに切り替え、安全な開発とデプロイメントを実現しています。
* **セキュリティ**: Firebase App Checkを導入し、不正なクライアントからのアクセスをブロック。アプリケーションの安全性を高めています。

---



## 📁 フォルダ構成

プロジェクトは機能ごとに整理された`features`ディレクトリを中心に構成されています。

```
lib
├── app/                  # アプリケーション全体のコア設定（main_tab_screen, theme, providers）
├── core/                 # プロジェクト横断的なコア機能（config, firebase, services, utils）
├── features/             # 機能ごとのディレクトリ
│   ├── admin/            # 管理者向け機能
│   ├── auth/             # 認証関連
│   ├── cluster/          # クラスタ（コミュニティ）関連
│   ├── notifications/    # 通知関連
│   ├── post/             # 投稿関連
│   ├── profile/          # プロフィール関連
│   ├── report/           # 通報機能関連
│   └── search/           # 検索機能関連
├── shared/               # 複数の機能で共有されるWidgetやスタイル
│   ├── styles/
│   └── widgets/
├── main_beta.dart        # Beta版のエントリーポイント
└── main_prod.dart        # Production版のエントリーポイント
```

---

